# üß† RAG-–±–æ—Ç –¥–ª—è Telegram

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram-–±–æ—Ç —Å Retrieval-Augmented Generation (RAG), –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –∏–∑–≤–ª–µ–∫–∞—è –∑–Ω–∞–Ω–∏—è —Å —Å–∞–π—Ç–∞ (–ø–æ sitemap) –∏ –¥–æ–ø–æ–ª–Ω—è—è –∏—Ö –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –º–æ–¥–µ–ª—å—é.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:

* **Google Gemini API** (LLM + —ç–º–±–µ–¥–¥–∏–Ω–≥–∏);
* **–õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏** —á–µ—Ä–µ–∑ `transformers` –∏ `sentence-transformers`;
* **FAISS** (–≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ);
* **BM25** (–ª–µ–∫—Å–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫);
* **–†–µ—Ä–∞–Ω–∫–µ—Ä** (CrossEncoder) –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞.
* –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –ø–æ –∫–∞—Ä—Ç–µ —Å–∞–π—Ç–∞ (`sitemap.xml`).
* –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (FAISS + BM25, —Å–ª–∏—è–Ω–∏–µ RRF).
* –•—Ä–∞–Ω–µ–Ω–∏–µ —Ö—ç—à–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—Ä–æ—Å—Å-—ç–Ω–∫–æ–¥–µ—Ä–∞ –¥–ª—è rerank.
* –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏ –æ–±–ª–∞—á–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
* –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ –Ω–∞ —á–∞–Ω–∫–∏.
* –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç: –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ + –ø—É–Ω–∫—Ç—ã + –≤—ã–≤–æ–¥.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ config.py       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ .env
‚îú‚îÄ‚îÄ main.py         # Telegram-–±–æ—Ç (aiogram)
‚îú‚îÄ‚îÄ rag_core.py     # –Ø–¥—Ä–æ RAG-—Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ scraper.py      # –ü–∞—Ä—Å–∏–Ω–≥ sitemap, –æ—á–∏—Å—Ç–∫–∞ HTML, –º–µ–Ω–µ–¥–∂–µ—Ä —Ö—ç—à–µ–π
‚îú‚îÄ‚îÄ data/           # –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö (–∏–Ω–¥–µ–∫—Å—ã, –∫—ç—à, —Ö—ç—à–∏)
‚îÇ   ‚îú‚îÄ‚îÄ vector_store/
‚îÇ   ‚îú‚îÄ‚îÄ bm25_corpus.jsonl
‚îÇ   ‚îú‚îÄ‚îÄ hash_storage.json
‚îÇ   ‚îî‚îÄ‚îÄ cache/
‚îî‚îÄ‚îÄ .env.example    # –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/Parallelogramator/Tg_search.git
cd Tg_search
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
python -m venv .venv
source .venv/bin/activate   # (Windows: .venv\Scripts\activate)
pip install -r requirements.txt
```

---

## üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª **`.env`** –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

–ü—Ä–∏–º–µ—Ä `.env.example`:

```env
# Telegram
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞

# Google API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
GOOGLE_API_KEY=

# –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏
LOCAL_EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2
LOCAL_LLM_MODEL=google/gemma-3-4b-it

# –ü–æ–≤–µ–¥–µ–Ω–∏–µ
USE_RERANKER=true
LOG_LEVEL=INFO

# –ò—Å—Ç–æ—á–Ω–∏–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_SITE=https://delprof.ru
DEFAULT_UPDATE_MAX_LINKS=200
```

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

```bash
python main.py
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –≤ Telegram.

---

## üí¨ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

* `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
* `/help` ‚Äî —Å–ø—Ä–∞–≤–∫–∞
* `/ping` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
* `/stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã (–∫–æ–ª-–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤/—á–∞–Ω–∫–æ–≤, –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
* `/update <url> [max]` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π —Å —Å–∞–π—Ç–∞ (–ø–æ sitemap)

–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å, –∏ –±–æ—Ç –Ω–∞–π–¥—ë—Ç –æ—Ç–≤–µ—Ç –≤ –±–∞–∑–µ.

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö**

   * –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã —Å–∞–π—Ç–∞ —á–µ—Ä–µ–∑ `robots.txt` –∏–ª–∏ `/sitemap.xml`.
   * –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ HTML (`BeautifulSoup`).
   * –•—Ä–∞–Ω–µ–Ω–∏–µ —Ö—ç—à–µ–π –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

2. **–ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ**

   * –¢–µ–∫—Å—Ç—ã –¥–µ–ª—è—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏ (`RecursiveCharacterTextSplitter`).
   * –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ FAISS + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ BM25 –∫–æ—Ä–ø—É—Å–∞.

3. **–ü–æ–∏—Å–∫ –æ—Ç–≤–µ—Ç–∞**

   * –ì–∏–±—Ä–∏–¥–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ (FAISS + BM25).
   * –°–ª–∏—è–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (RRF).
   * –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π rerank (`CrossEncoder`).
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ (Google Gemini –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å).

---

## üìä –ü—Ä–∏–º–µ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (`/stats`)

```
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã:
- –î–æ–∫—É–º–µ–Ω—Ç–æ–≤: 45
- –ß–∞–Ω–∫–æ–≤: 320
- –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-08-18T01:18:57
```

---

## üõ†Ô∏è –î–æ—Ä–∞–±–æ—Ç–∫–∏

* [ ] –î–æ–±–∞–≤–∏—Ç—å Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—é.
* [ ] –í—ã–Ω–µ—Å—Ç–∏ LLM-—á–µ–π–Ω –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏.
* [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–∞–π—Ç–æ–≤/–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
* [ ] –í–µ–±-–ø–∞–Ω–µ–ª—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

